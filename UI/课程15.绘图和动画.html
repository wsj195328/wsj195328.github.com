<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>课程15.绘图和动画</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><img src="http://static.zybuluo.com/zhuoming/9y9ocj9x0iw2k87m7br254g1/logo.png" width="300" height="100"><span style="float:right;" data-anchor-id="m3vg"><b>求知若渴 求真教育</b></span><div class="md-section-divider"></div><h1 data-anchor-id="rsas" id="课程15绘图和动画">课程15.绘图和动画</h1><p data-anchor-id="mtmx"><code>iOS</code> <code>UI</code></p><hr><p data-anchor-id="5b6m"><div class="toc"><div class="toc">
<ul>
<li><a href="#课程15绘图和动画">课程15.绘图和动画</a><ul>
<li><a href="#一学习目标">一、学习目标</a></li>
<li><a href="#二课程内容">二、课程内容</a><ul>
<li><a href="#1transform">1.transform</a></li>
<li><a href="#2系统动画">2.系统动画</a></li>
<li><a href="#3绘图和drawrect">3.绘图和DrawRect</a><ul>
<li><a href="#1quartz概述">1.Quartz概述</a></li>
<li><a href="#2视图绘制">2.视图绘制</a></li>
<li><a href="#3图形上下文">3.图形上下文</a></li>
<li><a href="#4drawrect">4.drawRect</a></li>
<li><a href="#5自定义view">5.自定义view</a><ul>
<li><a href="#定义view的步骤">⾃定义view的步骤:</a></li>
<li><a href="#代码及效果">代码及效果</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#三课程作业">三、课程作业</a></li>
</ul>
</li>
</ul>
</div>
</div>
</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="k94i" id="一学习目标"><strong>一、学习目标</strong></h2><ul data-anchor-id="eqih">
<li>UIView的transform属性</li>
<li>UIView的系统动画</li>
<li>通过CATransition定制动画</li>
<li>绘图Drawrect</li>
</ul><hr><div class="md-section-divider"></div><h2 data-anchor-id="mauz" id="二课程内容"><strong>二、课程内容</strong></h2><div class="md-section-divider"></div><h3 data-anchor-id="uejc" id="1transform"><strong>1.transform</strong></h3><p data-anchor-id="9ibx">在UIView中有一个transform属性，我们通过transform属性可以修改对象的平移、缩放比例和旋转角度。 <br>
常用的创建transform结构体方法分两大类： <br>
<strong>1:针对视图原始坐标的变化：</strong></p><blockquote data-anchor-id="lt4e" class="white-blockquote">
  <ul>
  <li>CAFFineTransforMakeTransion平移操作</li>
  <li>CAFFineTransforMakescale缩放操作</li>
  <li>CAFFineTransforMakeRatone翻转操作</li>
  </ul>
</blockquote><p data-anchor-id="rt20"><strong>2:针对视图当前坐标的变化</strong>：</p><blockquote data-anchor-id="kd9h" class="white-blockquote">
  <ul>
  <li>CAFFineTransforTransion 在当前view的transform基础上平移</li>
  <li>CAFFineTransforscale        在当前view的transform基础上缩放</li>
  <li>CAFFineTransforRatone   在当前view的transform基础上翻转</li>
  </ul>
</blockquote><p data-anchor-id="6e8f">直接看代码和效果</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="hfr9"><ol class="linenums"><li class="L0"><code><span class="com">// 旋转 传入参数是double类型，代表弧度，弧度制的0-2pi相当于角度制的0-360,可以借助枚举或自己转化</span></code></li><li class="L1"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnTurnLeftClick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 只能旋转一次</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//self.headImg.transform = CGAffineTransformMakeRotation(M_PI_4);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">// 当前的基础上旋转</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformRotate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">M_PI_4</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pun">}</span></code></li><li class="L7"><code><span class="com">// 旋转</span></code></li><li class="L8"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnTurnRightClick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformRotate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> M_PI_4</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pun">}</span></code></li><li class="L1"><code><span class="com">// 放大</span></code></li><li class="L2"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnBigCLick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//CGAffineTransformMakeScale(1.1, 1.1); 只能放大原来图片到1.1倍</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">//self.headImg.transform = CGAffineTransformMakeScale(1.1, 1.1);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformScale</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.1</span><span class="pun">);</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pun">}</span></code></li><li class="L8"><code><span class="com">// 缩小</span></code></li><li class="L9"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnSmallCLick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">//CGAffineTransformMakeScale(0.9, 0.9); 只能缩小原来图片到0.9倍</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">//self.headImg.transform = CGAffineTransformMakeScale(0.9, 0.9);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformScale</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="lit">0.9</span><span class="pun">,</span><span class="lit">0.9</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pun">}</span></code></li><li class="L4"><code><span class="com">// 往上移动 10</span></code></li><li class="L5"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnUpClick</span><span class="pun">:(</span><span class="typ">UIButton</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformTranslate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">10</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pun">}</span></code></li><li class="L8"><code><span class="com">// 往右移动 10</span></code></li><li class="L9"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnRightClick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">   </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformTranslate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pun">}</span></code></li><li class="L2"><code><span class="com">// 往下移动 10</span></code></li><li class="L3"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnDownClick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformTranslate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">+</span><span class="lit">10</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code><span class="com">// 往左移动 10</span></code></li><li class="L7"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IBAction</span><span class="pun">)</span><span class="pln">btnLeftClick</span><span class="pun">:(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">sender </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformTranslate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="ie1x"><img src="http://static.zybuluo.com/zhuoming/va1l4i8xber1l91lzqqmbwiq/xib30.gif" alt="xib30.gif-1973.6kB" title=""></p><div class="md-section-divider"></div><h3 data-anchor-id="wi71" id="2系统动画"><strong>2.系统动画</strong></h3><p data-anchor-id="4gnr">在iOS中随处都可以看到绚丽的动画效果，实现这些动画的过程并不复杂，今天我来学习简单的系统基础动画。并结合上面的例子，添加动画效果。 <br>
添加动画有两种方式 <br>
* 使用UIView类函数实现:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7dt1"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">UIView</span><span class="pln"> beginAnimations</span><span class="pun">:@</span><span class="str">"animationID"</span><span class="pln"> context</span><span class="pun">:</span><span class="kwd">nil</span><span class="pun">];</span></code></li><li class="L1"><code><span class="pun">[</span><span class="typ">UIView</span><span class="pln"> setAnimationDuration</span><span class="pun">:</span><span class="lit">1.2f</span><span class="pun">];</span><span class="pln"> </span><span class="com">//动画时长</span></code></li><li class="L2"><code><span class="pun">[</span><span class="typ">UIView</span><span class="pln"> setAnimationCurve</span><span class="pun">:</span><span class="typ">UIViewAnimationCurveEaseInOut</span><span class="pun">];</span></code></li><li class="L3"><code><span class="com">//在这里添加动画代码</span></code></li><li class="L4"><code><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformTranslate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">[</span><span class="typ">UIView</span><span class="pln"> commitAnimations</span><span class="pun">];</span><span class="pln"> </span><span class="com">//提交动画</span></code></li></ol></pre><ul data-anchor-id="imcz">
<li>使用block语法实现动画效果</li>
</ul><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4o6f"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="typ">UIView</span><span class="pln"> animateWithDuration</span><span class="pun">:</span><span class="lit">1.3f</span><span class="pln"> animations</span><span class="pun">:^{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGAffineTransformRotate</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">headImg</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">M_PI_4</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> completion</span><span class="pun">:^(</span><span class="pln">BOOL finished</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="com">// 结束的回调</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}];</span></code></li></ol></pre><p data-anchor-id="5i6d"><img src="http://static.zybuluo.com/zhuoming/amvnuzh977p348sfrwjd4mig/xib31.gif" alt="xib31.gif-1012.5kB" title=""></p><div class="md-section-divider"></div><h3 data-anchor-id="fj94" id="3绘图和drawrect"><strong>3.绘图和DrawRect</strong></h3><div class="md-section-divider"></div><h4 data-anchor-id="pgb6" id="1quartz概述">1.Quartz概述</h4><p data-anchor-id="col3">Quartz是Mac OS X的Darwin核心之上的绘图层，有时候也认为是CoreGraphics。共有两种部分组成Quartz：</p><ul data-anchor-id="f3mu">
<li>Quartz Compositor，合成视窗系统，管理和合成幕后视窗影像来建立Mac OS X使用者接口。</li>
<li>Quartz 2D，是iOS和Mac OS X环境下的二维绘图引擎。</li>
</ul><p data-anchor-id="9jze">涉及内容包括：基于路径的绘图，透明度绘图，遮盖，阴影，透明层，颜色管理，防锯齿渲染，生成PDF，以及PDF元数据相关处理。</p><div class="md-section-divider"></div><h4 data-anchor-id="jjm2" id="2视图绘制">2.视图绘制</h4><p data-anchor-id="oj60">在iOS上，所有的绘制，无论是否采用OpenGL、Quartz、UIKit、或者 Core Animation—都发生在UIView对象的区域内。如果使用系统提供的视图，绘制工作会自动得到处理。比如</p><ul data-anchor-id="upwn">
<li>UILabel:显⽰文字</li>
<li>UIImageView:显示图片</li>
<li>UIButton:同时显示图片和⽂字(能点击)</li>
</ul><p data-anchor-id="cqeb">然而，如果想定义自己的定制视图，则必须自行提供绘制代码。</p><div class="md-section-divider"></div><h4 data-anchor-id="lart" id="3图形上下文">3.图形上下文</h4><p data-anchor-id="ve4b">在调用您提供的drawRect:方法之前，视图对象会自动配置其绘制环境，使您的代码可以立即进行绘制。作为这些配置的一部分，UIView对象会为当前绘制环境创建一个图形上下文（Graphics Context ，是CGContextRef封装类型）。该图形上下文包含绘制系统执行后续绘制命令所需要的信息，定义了各种基本的绘制属性，比如绘制使用的颜色、裁剪区域、线的宽度及风格信息、字体信息、合成选项、以及几个其它信息。我们可以将Graphics Context理解为一块画布,我们可以在上面进行绘画操作,绘制完成后,将画布放到我们的view中显示即可,view看作是一个画框.</p><div class="md-section-divider"></div><h4 data-anchor-id="3yq1" id="4drawrect">4.drawRect</h4><p data-anchor-id="lgx9"><code>- (void)drawRect:(CGRect)rect</code> <br>
在drawRect:⽅法中才能取得跟view相关联的图形上下文，也才能将图绘制上去。这个方法会在第一次显示到屏幕上的时候调用<code>setNeedsDisplaysetNeedsDisplayInRect:</code>。</p><div class="md-section-divider"></div><h4 data-anchor-id="208p" id="5自定义view">5.自定义view</h4><div class="md-section-divider"></div><h5 data-anchor-id="nxna" id="定义view的步骤"><strong>⾃定义view的步骤:</strong></h5><p data-anchor-id="p0c1">1.获得图形上下文: <br>
<code>CGContextRef ctx = UIGraphicsGetCurrentContext();</code> <br>
2.拼接路径</p><ul data-anchor-id="kz4o">
<li>新建一个起点  <br>
<code>void CGContextMoveToPoint(CGContextRef c, CGFloat x, CGFloat y)</code></li>
<li>添加新的线段到某个点  <br>
<code>void CGContextAddLineToPoint(CGContextRef c, CGFloat x, CGFloat y)</code></li>
<li>添加一个矩形  <br>
<code>void CGContextAddRect(CGContextRef c, CGRect rect)</code></li>
<li>添加一个椭圆  <br>
<code>void CGContextAddEllipseInRect(CGContextRef context, CGRect rect)</code></li>
<li>添加一个圆弧 <br>
<code>void CGContextAddArc(CGContextRef c, CGFloat x, CGFloat y, CGFloat radius, CGFloat startAngle, CGFloat endAngle, int clockwise)</code></li>
</ul><p data-anchor-id="gbxz">3.添加路径到上下文</p><ul data-anchor-id="o78a">
<li>Mode参数决定绘制的模式  <br>
<code>void CGContextDrawPath(CGContextRef c, CGPathDrawingMode mode)</code></li>
<li>绘制空心路径  <br>
<code>void CGContextStrokePath(CGContextRef c)</code></li>
<li>绘制实心路径  <br>
<code>void CGContextFillPath(CGContextRef c)</code></li>
</ul><blockquote data-anchor-id="dtzl" class="white-blockquote">
  <p>tips  <br>
  提示：一般以CGContextDraw、CGContextStroke、CGContextFill开头的函数，都是用来绘制路径的</p>
</blockquote><p data-anchor-id="fna1">4.渲染到View上面 <br>
 <code>CGContextStrokePath(ctx);</code></p><div class="md-section-divider"></div><h5 data-anchor-id="z416" id="代码及效果"><strong>代码及效果</strong></h5><p data-anchor-id="bedx"><strong>1.画线</strong></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="098i"><ol class="linenums"><li class="L0"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawRect</span><span class="pun">:(</span><span class="typ">CGRect</span><span class="pun">)</span><span class="pln">rect </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">[</span><span class="kwd">self</span><span class="pln"> drawLine</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pun">}</span></code></li><li class="L3"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawLine</span></code></li><li class="L4"><code><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">//-------------------------------</span></code></li><li class="L6"><code><span class="pln">    </span><span class="com">// 一个路径对象，可以对应多跟线</span></code></li><li class="L7"><code><span class="pln">    </span><span class="com">// 1.获取跟当前view想关联的上下文,系统自动帮我们创建的上下文</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">CGContextRef</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> </span><span class="typ">UIGraphicsGetCurrentContext</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 设置上下文的状态,应该放在渲染之前就可以</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">// 创建对应颜色对象，调用set方法</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">[[</span><span class="typ">UIColor</span><span class="pln"> redColor</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">];</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 设置上下文的线宽</span></code></li><li class="L3"><code><span class="pln">    </span><span class="typ">CGContextSetLineWidth</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">// 设置线段的连接样式</span></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">CGContextSetLineJoin</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> kCGLineJoinRound</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="com">// 设置线段的端点样式,帽子</span></code></li><li class="L7"><code><span class="pln">    </span><span class="typ">CGContextSetLineCap</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> kCGLineCapRound</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com">//------------------------------</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 2.拼接路径，UIBezierPath,封装好了一套很好使用的路径</span></code></li><li class="L0"><code><span class="pln">    </span><span class="typ">UIBezierPath</span><span class="pln"> </span><span class="pun">*</span><span class="pln">path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIBezierPath</span><span class="pln"> bezierPath</span><span class="pun">];</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 2.1 设置起点</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path moveToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">)];</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">// 2.2 添加一根线到某个点</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path addLineToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">220</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">)];</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 如果只使用一根路径，默认下一根线的起点在上一根跟线终点</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path addLineToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="lit">300</span><span class="pun">)];</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path addLineToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">220</span><span class="pun">,</span><span class="pln"> </span><span class="lit">300</span><span class="pun">)];</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com">//---------------------------------</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 3.添加路径到上下文</span></code></li><li class="L0"><code><span class="pln">    </span><span class="typ">CGContextAddPath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">.</span><span class="typ">CGPath</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 4.渲染到view上面的图层</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">CGContextStrokePath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="l3kj"><strong>2.绘制曲线</strong> :一般通过贝塞尔曲线来绘制图形：UIBezierPath</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bbb0"><ol class="linenums"><li class="L0"><code><span class="pun">-(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawLIneQuadCurve</span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 1.获取上下文</span></code></li><li class="L3"><code><span class="pln">    </span><span class="typ">CGContextRef</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> </span><span class="typ">UIGraphicsGetCurrentContext</span><span class="pun">();</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">[[</span><span class="typ">UIColor</span><span class="pln"> redColor</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">];</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 2.拼接路径</span></code></li><li class="L6"><code><span class="pln">    </span><span class="typ">UIBezierPath</span><span class="pln"> </span><span class="pun">*</span><span class="pln">path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIBezierPath</span><span class="pln"> bezierPath</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path moveToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">)];</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path addQuadCurveToPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">240</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">)</span><span class="pln"> controlPoint</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)];</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 3.路径添加到上下文</span></code></li><li class="L0"><code><span class="pln">    </span><span class="typ">CGContextAddPath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">.</span><span class="typ">CGPath</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 4.渲染上下文</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">//以填充的方式渲染</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//CGContextFillPath(ctx);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="typ">CGContextStrokePath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="lc9i"><strong>3.绘制矩形</strong></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bew6"><ol class="linenums"><li class="L0"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawRect</span></code></li><li class="L1"><code><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">CGContextRef</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> </span><span class="typ">UIGraphicsGetCurrentContext</span><span class="pun">();</span></code></li><li class="L3"><code><span class="pln">    </span><span class="typ">UIBezierPath</span><span class="pln"> </span><span class="pun">*</span><span class="pln">path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIBezierPath</span><span class="pln"> bezierPathWithRoundedRect</span><span class="pun">:</span><span class="typ">CGRectMake</span><span class="pun">(</span><span class="lit">50</span><span class="pun">,</span><span class="pln"> </span><span class="lit">50</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">)</span><span class="pln"> cornerRadius</span><span class="pun">:</span><span class="lit">50</span><span class="pun">];</span></code></li><li class="L4"><code><span class="pln">    </span><span class="typ">CGContextAddPath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">.</span><span class="typ">CGPath</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 设置填充的颜色</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">[[</span><span class="typ">UIColor</span><span class="pln"> redColor</span><span class="pun">]</span><span class="pln"> setFill</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">    </span><span class="com">// 线条的颜色</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">[[</span><span class="typ">UIColor</span><span class="pln"> greenColor</span><span class="pun">]</span><span class="pln"> setStroke</span><span class="pun">];</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 填充：必须封闭的路径</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">// 即描边又填充</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 如果以后只需要描边，最好不要使用fill</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">CGContextDrawPath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">,</span><span class="pln"> kCGPathFillStroke</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//    CGContextFillPath(ctx);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="typ">CGContextStrokePath</span><span class="pun">(</span><span class="pln">ctx</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="r38h"><strong>4.绘制圆弧</strong></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xsoh"><ol class="linenums"><li class="L0"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawArc</span><span class="pun">:(</span><span class="typ">CGRect</span><span class="pun">)</span><span class="pln">rect </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 画圆弧</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// center：圆心</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">// radius：半径</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">// clockwise：当前是 yes：顺时针 no：逆时针</span></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">CGPoint</span><span class="pln"> center </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="typ">UIBezierPath</span><span class="pln"> </span><span class="pun">*</span><span class="pln">path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIBezierPath</span><span class="pln"> bezierPathWithArcCenter</span><span class="pun">:</span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">)</span><span class="pln"> radius</span><span class="pun">:</span><span class="lit">100</span><span class="pln"> startAngle</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> endAngle</span><span class="pun">:-</span><span class="pln">M_PI_2  clockwise</span><span class="pun">:</span><span class="pln">NO</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">    </span><span class="com">// 添加一根线到圆心</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path addLineToPoint</span><span class="pun">:</span><span class="pln">center</span><span class="pun">];</span></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 关闭路径：从路径的终点到起点</span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">// [path closePath];</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// 填充，默认会关闭路径，从路径的终点到起点</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">[</span><span class="pln">path fill</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="mm1t"><strong>5.绘制饼状图</strong></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="e9mm"><ol class="linenums"><li class="L0"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">drawArcRect</span><span class="pun">:(</span><span class="typ">CGRect</span><span class="pun">)</span><span class="pln">rect </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="com">// Drawing code</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">NSArray</span><span class="pln"> </span><span class="pun">*</span><span class="pln">datas </span><span class="pun">=</span><span class="pln"> </span><span class="pun">@[@</span><span class="lit">25</span><span class="pun">,@</span><span class="lit">25</span><span class="pun">,@</span><span class="lit">50</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pln">    </span><span class="typ">CGPoint</span><span class="pln"> center </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CGPointMake</span><span class="pun">(</span><span class="lit">125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> startA </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> angle </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> endA </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">NSNumber</span><span class="pln"> </span><span class="pun">*</span><span class="pln">number </span><span class="kwd">in</span><span class="pln"> datas</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">// 遍历一个数据，绘制一根扇形</span></code></li><li class="L0"><code><span class="pln">        startA </span><span class="pun">=</span><span class="pln"> endA</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        angle </span><span class="pun">=</span><span class="pln"> number</span><span class="pun">.</span><span class="pln">intValue </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100.0</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> M_PI </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">        endA </span><span class="pun">=</span><span class="pln"> startA </span><span class="pun">+</span><span class="pln"> angle</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="com">// 描述圆弧</span></code></li><li class="L4"><code><span class="pln">        </span><span class="typ">UIBezierPath</span><span class="pln"> </span><span class="pun">*</span><span class="pln">path </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIBezierPath</span><span class="pln"> bezierPathWithArcCenter</span><span class="pun">:</span><span class="pln">center radius</span><span class="pun">:</span><span class="pln">r startAngle</span><span class="pun">:</span><span class="pln">startA endAngle</span><span class="pun">:</span><span class="pln">endA clockwise</span><span class="pun">:</span><span class="pln">YES</span><span class="pun">];</span></code></li><li class="L5"><code><span class="pln">        </span><span class="pun">[</span><span class="pln">path addLineToPoint</span><span class="pun">:</span><span class="pln">center</span><span class="pun">];</span></code></li><li class="L6"><code><span class="pln">        </span><span class="pun">[[</span><span class="kwd">self</span><span class="pln"> randomColor</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">];</span></code></li><li class="L7"><code><span class="pln">        </span><span class="pun">[</span><span class="pln">path fill</span><span class="pun">];</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pun">}</span></code></li><li class="L0"><code><span class="com">//当点击View的时候，重绘</span></code></li><li class="L1"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">void</span><span class="pun">)</span><span class="pln">touchesBegan</span><span class="pun">:(</span><span class="typ">NSSet</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">touches withEvent</span><span class="pun">:(</span><span class="typ">UIEvent</span><span class="pln"> </span><span class="pun">*)</span><span class="kwd">event</span></code></li><li class="L2"><code><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">[</span><span class="kwd">self</span><span class="pln"> setNeedsDisplay</span><span class="pun">];</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code><span class="com">//生成随机的颜色</span></code></li><li class="L7"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">UIColor</span><span class="pln"> </span><span class="pun">*)</span><span class="pln">randomColor</span></code></li><li class="L8"><code><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> arc4random_uniform</span><span class="pun">(</span><span class="lit">256</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">255.0</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> g </span><span class="pun">=</span><span class="pln"> arc4random_uniform</span><span class="pun">(</span><span class="lit">256</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">255.0</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="typ">CGFloat</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> arc4random_uniform</span><span class="pun">(</span><span class="lit">256</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">255.0</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">[</span><span class="typ">UIColor</span><span class="pln"> colorWithRed</span><span class="pun">:</span><span class="pln">r green</span><span class="pun">:</span><span class="pln">g blue</span><span class="pun">:</span><span class="pln">b alpha</span><span class="pun">:</span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="pbx6" id="三课程作业"><strong>三、课程作业</strong></h2><blockquote data-anchor-id="f6uz" class="white-blockquote">
  <ul>
  <li><p>1.利用基础动画实现以下效果 <br>
  <img src="http://static.zybuluo.com/zhuoming/zr6fbs0kks9kme2r4kxtl34r/xib32.gif" alt="xib32.gif-392.7kB" title=""></p></li>
  <li><p>2.自定义一个View，用drawRect绘制一个六芒星，或者太极图。 <br>
  <img src="http://static.zybuluo.com/zhuoming/ajt37lr5yiv9ghuw5637idi2/547c2651933bf0d1068b5dd4_1.gif" alt="547c2651933bf0d1068b5dd4_1.gif-243kB" title=""></p></li>
  </ul>
</blockquote></div>
</body>
</html>